# Auto-Update Configuration

FMMLoader26 uses Tauri's built-in updater plugin for automatic updates.

## How It Works

When the app starts, it checks for updates from:
```
https://github.com/justinlevinedotme/FMMLoader-26/releases/latest/download/latest.json
```

This JSON file is automatically generated by the `tauri-action` GitHub workflow when you create a release.

## User Experience

1. **Check on Startup**: App automatically checks for updates when launched
2. **Update Dialog**: If an update is available, Tauri shows a native dialog with:
   - Current version
   - New version
   - Install/Skip buttons
3. **Silent Install**: Update downloads and installs in the background
4. **Restart**: User is prompted to restart the app to complete the update

## Configuration

The updater is configured in `src-tauri/tauri.conf.json`:

```json
{
  "plugins": {
    "updater": {
      "active": true,
      "endpoints": [
        "https://github.com/justinlevinedotme/FMMLoader-26/releases/latest/download/latest.json"
      ],
      "dialog": true,
      "pubkey": "",
      "windows": {
        "installMode": "passive"
      }
    }
  }
}
```

### Options Explained

- **`active: true`** - Enables the updater
- **`endpoints`** - URL(s) to check for updates (GitHub releases in our case)
- **`dialog: true`** - Show native update dialog instead of silent updates
- **`pubkey: ""`** - Public key for signature verification (empty = no signature verification)
- **`windows.installMode: "passive"`** - Install without user interaction on Windows

## Signing Updates (Optional)

For production, you should sign your updates:

1. **Generate a keypair:**
   ```bash
   npm run tauri signer generate -- -w ~/.tauri/myapp.key
   ```

2. **Update `tauri.conf.json`:**
   ```json
   {
     "plugins": {
       "updater": {
         "pubkey": "YOUR_PUBLIC_KEY_HERE"
       }
     }
   }
   ```

3. **Sign releases in GitHub Actions:**
   Set `TAURI_PRIVATE_KEY` and `TAURI_KEY_PASSWORD` as repository secrets.

## Creating a Release

The GitHub workflow automatically handles everything when you push a tag:

```bash
git tag v1.0.1
git push origin v1.0.1
```

This triggers the workflow which:
1. Builds for all platforms (Windows, macOS, Linux)
2. Creates installers
3. Generates `latest.json` with update information
4. Uploads everything to GitHub Releases

## Testing Updates

To test the updater locally:

1. **Create a test release** on GitHub with a higher version number
2. **Run your local dev build** - it will detect the newer version
3. **Click "Install"** in the update dialog
4. **App will download and install** the update

## Manual Update Checks

The app automatically checks for updates on startup. There's no manual "Check for Updates" button since Tauri handles this automatically.

## Troubleshooting

### Update check fails
- Verify the GitHub release exists
- Check that `latest.json` was generated
- Ensure network connectivity

### Update won't install
- On Windows: Check if antivirus is blocking
- On macOS: Verify app is signed (for production)
- Check app has write permissions

### Wrong version detected
- Ensure `version` in `src-tauri/tauri.conf.json` matches `package.json`
- Version must follow semantic versioning (e.g., `1.0.0`)

## Update JSON Structure

The auto-generated `latest.json` looks like:

```json
{
  "version": "1.0.1",
  "notes": "See the assets to download this version and install.",
  "pub_date": "2024-01-15T12:00:00Z",
  "platforms": {
    "windows-x86_64": {
      "signature": "",
      "url": "https://github.com/.../FMMLoader26_1.0.1_x64-setup.nsis.zip"
    },
    "darwin-aarch64": {
      "signature": "",
      "url": "https://github.com/.../FMMLoader26_1.0.1_aarch64.dmg.tar.gz"
    },
    "linux-x86_64": {
      "signature": "",
      "url": "https://github.com/.../fmmloader26_1.0.1_amd64.AppImage.tar.gz"
    }
  }
}
```

## Resources

- [Tauri Updater Documentation](https://v2.tauri.app/plugin/updater/)
- [GitHub Actions Workflow](.github/workflows/build.yml)
- [Tauri Action](https://github.com/tauri-apps/tauri-action)
